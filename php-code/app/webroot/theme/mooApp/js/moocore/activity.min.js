(function(a,c){"function"===typeof define&&define.amd?define("jquery mooPhrase mooBehavior mooMention mooEmoji mooFileUploader mooUser mooButton mooGlobal mooResponsive mooAttach mooComment mooLike autogrow spinner".split(" "),c):"object"===typeof exports?module.exports=c(require("jquery")):a.mooActivities=c()})(this,function(a,c,l,g,u,m,v,n,p,w,x,f,y){var A=function(){a(".removeTags").unbind("click");a(".removeTags").click(function(){var b=a(this).data();z(b.activityId,b.activityItemType)})},z=function(b,
d){a.fn.SimpleModal({btn_ok:c.__("confirm"),btn_cancel:c.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/activities/ajax_remove_tags",{item_id:b,item_type:d},function(){window.location.reload()})},title:c.__("remove_tags"),contents:c.__("remove_tags_contents"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},B=function(){a(".showAllComments").unbind("click");a(".showAllComments").on("click",function(){var b=a(this).data().id;a("#comments_"+b+" .hidden").fadeIn();a("#comments_"+
b+" .hidden").attr("class","");a("#all_comments_"+b).hide()})},C=function(b){a.fn.SimpleModal({btn_ok:c.__("ok"),btn_cancel:c.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/activities/ajax_remove",{id:b},function(){a("#activity_"+b).fadeOut("normal",function(){a("#activity_"+b).remove()})})},title:c.__("please_confirm"),contents:c.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},E=function(){a(".editActivity").unbind("click");a(".editActivity").click(function(){var b=
a(this).data();D(b.activityId)})},F=function(){a(".removeActivity").unbind("click");a(".removeActivity").click(function(){var b=a(this).data();C(b.activityId)})},h=[],D=function(b){0==a("#activity_edit_"+b).length&&a.post(mooConfig.url.base+"/activities/ajax_loadActivityEdit/"+b,function(d){a("#activity_feed_content_text_"+b+" .comment_message").hide();a(d).insertAfter(a("#activity_feed_content_text_"+b+" .comment_message"));h.push(b);k();g.init(a(d).find("textarea").attr("id"),"edit_activity");u.init(a(d).find("textarea").attr("id"))})},
q=function(b){a("#message_edit_"+b).siblings(".textoverlay")&&a("#message_edit_"+b).destroyOverlayInstance(a("#message_edit_"+b));a("#activity_feed_content_text_"+b+" .comment_message").show();a("#activity_edit_"+b).remove();b=a.inArray(b,h);h.splice(b,1)},G=function(b){if(""!=a.trim(a("#message_edit_"+b).val())){var d=0!=a("#message_edit_"+b+"_hidden").length?a("#message_edit_"+b+"_hidden").val():a("#message_edit_"+b).val();a.post(mooConfig.url.base+"/activities/ajax_editActivity/"+b,{message:d},
function(d){a("#message_edit_"+b).siblings(".textoverlay")&&a("#message_edit_"+b).destroyOverlayInstance(a("#message_edit_"+b));a("#activity_feed_content_text_"+b+" .comment_message").html(a(d).html());a("#history_activity_"+b).show();q(b)})}},H=function(b){a.fn.SimpleModal({btn_ok:c.__("ok"),btn_cancel:c.__("cancel"),callback:function(){a.post(mooConfig.url.base+"/comments/ajax_remove",{id:b},function(){a("#photo_comment_"+b).fadeOut("normal",function(){a("#photo_comment_"+b).remove()})})},title:c.__("please_confirm"),
contents:c.__("please_confirm_remove_this_activity"),model:"confirm",hideFooter:!1,closeButton:!1}).showModal()},I=function(b){if(""!=a.trim(a("#commentForm_"+b).val())||""!=a("#comment_image_"+b).val()){a("#commentButton_"+b+" a").addClass("disabled");a("#commentButton_"+b+" a").prepend('<i class="icon-refresh icon-spin"></i>');var d=0<a("#commentForm_"+b).siblings("input.messageHidden").length?a("#commentForm_"+b).siblings("input.messageHidden").val():a("#commentForm_"+b).val();a.post(mooConfig.url.base+
"/activities/ajax_comment",{activity_id:b,thumbnail:a("#comment_image_"+b).val(),comment:d},function(d){""!=d&&(r(b,d),d=a("#commentForm_"+b),g.resetMention(d),componentHandler.upgradeAllRegistered())})}},J=function(b,d,c){if(""!=a.trim(a("#commentForm_"+c).val())||""!=a("#comment_image_"+c).val()){a("#commentButton_"+c+" a").prepend('<i class="icon-refresh icon-spin"></i>');a("#commentButton_"+c+" a").addClass("disabled");var e="",e=0<a("#commentForm_"+c).siblings(".messageHidden").length?a("#commentForm_"+
c).siblings(".messageHidden").val():a("#commentForm_"+c).val();a.post(mooConfig.url.base+"/comments/ajax_share",{type:b,target_id:d,thumbnail:a("#comment_image_"+c).val(),message:e,activity:1},function(b){""!=b&&(r(c,b),b=a("#commentForm_"+c),g.resetMention(b),componentHandler.upgradeAllRegistered())})}},r=function(b,d){"1"===mooConfig.comment_sort_style?a("#newComment_"+b).before(d):a("#newComment_"+b).after(d);a(".slide").slideDown();a("#commentButton_"+b+" a").removeClass("disabled");a("#commentButton_"+
b+" a i").remove();a("#commentForm_"+b).val("");a("#commentButton_"+b).hide();a(".commentBox").css("height","27px");a("#comment_preview_image_"+b).html("");a("#comment_image_"+b).val("");a("#comment_button_attach_"+b).show();l.registerImageComment();k()},K=function(b,d,c){a.post(mooConfig.url.base+"/activities/ajax_changeActivityPrivacy/",{activityId:d,privacy:c},function(a){if(""!=a){a=JSON.parse(a);switch(a.icon){case "icon-globe-1":var c="public";break;case "icon-users-1":c="people";break;case "icon-lock-1":c=
"lock"}var e=b.parents(".dropdown");e.find("a#permission_"+d).attr("original-title",a.text);e.find("a#permission_"+d+" i").html(c);e.find(".dropdown-menu li a").removeClass("n52");b.addClass("n52")}})},k=function(b){a("textarea:not(.no-grow)").autogrow();A();E();F();f.initEditActivityComment();f.initRemoveActivityComment();f.initRemoveItemComment();a("body").off("click.activity","a.admin-or-owner-confirm-delete-photo-comment").on("click.activity","a.admin-or-owner-confirm-delete-photo-comment",function(){var b=
a(this).data();H(b.commentId)});a("body").off("click.activity","a.viewer-submit-comment").on("click.activity","a.viewer-submit-comment",function(){var b=a(this).data();I(b.activityId)});a("body").off("click.activity","a.viewer-submit-item-comment").on("click.activity","a.viewer-submit-item-comment",function(){var b=a(this).data();J(b.itemType,b.activityItemId,b.activityId)});a("body").off("click.activity","a.change-activity-privacy").on("click.activity","a.change-activity-privacy",function(){var b=
a(this).data();K(a(this),b.activityId,b.privacy)});f.initShowCommentForm();y.initLikeActivity();f.initRemoveItemComment();f.initEditItemComment();f.initShowCommentBtn();B();l.initMoreResults();componentHandler.upgradeAllRegistered()},t=function(){a("#video_pc_feed_preview").hide();a("#title").val("");a("#description").val("");a("#video_destination").val("")},L=function(){if(!v.validateUser())return!1;var b=a("#message").val();""!=a.trim(b)||""!=a("#wall_photo_preview :not(#addMoreImage)").html()&&
"add"!=a("#wall_photo_preview :not(#addMoreImage)").html()?(console.log("111"),n.disableButton("status_btn"),a("#status_btn").spin("small"),a.post(mooConfig.url.base+"/activities/ajax_share",a("#wallForm").serialize(),function(b){a("#wall_photo").val("");n.enableButton("status_btn");a("#message").val("");0<a("#video_destination").length&&""!=a("#video_destination").val()?(a.fn.SimpleModal({btn_ok:c.__("btn_ok"),btn_cancel:c.__("cancel"),model:"modal",title:c.__("processing_video"),contents:c.__("processing_video_msg")}).showModal(),
setTimeout(function(){a("#simpleModal").hide();a(".modal-backdrop").remove()},3E3),t(),b=a.parseJSON(b),a.post(mooConfig.url.base+"/upload_video/upload_videos/feed_convert",{activity_id:b.activity_id},function(a){})):""!=b&&(0<a(".no-feed").length&&a("#list-content .no-feed").remove(),a("#list-content").prepend(b),a("#message").css("height","36px"),a(".slide").slideDown(),a("#wall_photo_preview span:not(.addMoreImage)").remove(),a("#addMoreImage").hide(),a(".form-feed-holder").css("padding-bottom",
"0px"),b=a(b).find("div[id^=comment_button_attach_]").data("id"),x.registerAttachComment(b));a("#status_btn").spin(!1);w.init();a(".tip").tipsy({html:!0,gravity:"s"});a('[data-toggle="tooltip"]').tooltip();b=a("#wallForm").find("#message");g.resetMention(b)}),a(".stt-action .userTagging-userTagging").addClass("hidden"),a(".stt-action").css("margin-top","0"),a("#wall_photo_preview").hide(),a("#userTagging").tagsinput("removeAll")):a.fn.SimpleModal({btn_ok:c.__("btn_ok"),btn_cancel:c.__("cancel"),model:"modal",
title:c.__("warning"),contents:c.__("share_whats_new_can_not_empty")}).showModal()};return{init:k,initActivityForm:function(){a('[data-toggle="tooltip"]').tooltip();new m.fineUploader({element:a("#select-2")[0],text:{uploadButton:'<div class="upload-section"><span class=" mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">local_see</i></span></div>'},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},multiple:!0,request:{endpoint:mooConfig.url.base+"/upload/wall"},
callbacks:{onError:p.errorHandler,onSubmit:function(b,c){a('<span id="feed_'+b+'" style="background-image:url('+mooConfig.url.base+'/img/indicator.gif);background-size:inherit;background-repeat:no-repeat"></span>').insertBefore(".addMoreImage");a("#wall_photo_preview").show();a("#addMoreImage").show();t()},onComplete:function(b,c,e,f){e.success&&(a(this.getItemByFileId(b)).remove(),a('<img src="'+e.file_path+'">').load(function(){var c=a("#feed_"+b);c.attr("style","background-image:url("+e.file_path+
")");var d=a('<a href="#"><i class="icon-delete"></i></a>');c.append(d);c.find(".icon-delete").unbind("click");c.find(".icon-delete").click(function(b){b.preventDefault();a(this).parents("span").remove();a("#wall_photo").val(a("#wall_photo").val().replace(e.photo+",",""))})}),c=a("#wall_photo").val(),a("#wall_photo").val(c+e.photo+","))}}});if(0<a("#videoPcFeed").length){var b=new m.fineUploader({element:a("#videoPcFeed")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">videocam</i></div>'},
validation:{allowedExtensions:mooConfig.videoExt,sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/upload_video/upload_videos/process_upload"},callbacks:{onError:p.errorHandler,onSubmit:function(b,c){a("#wall_photo_preview").hide();a("#video_pc_feed_preview").show();a(".video_thumb").spin("medium")},onComplete:function(b,c,e){e.success&&(a("#video_destination").val(e.filename),a(".video_thumb").spin(!1))}}});a("#triggerUpload").click(function(){b._storedFileIds.length?(b.uploadStoredFiles(),
a(".error-message").hide()):(a(".error-message").html(c.__("uv_4")),a(".error-message").show())})}a("#addMoreImage").unbind("click");a("#addMoreImage").click(function(){a("#select-2 input[name=file]").click()});a("#message").on("focus",function(){f.showCommentButton(0)});a("#status_btn").unbind("click");a("#status_btn").click(function(){L()});a("#status_box").slideDown("slow")},initOnAjaxLoadActivityEdit:function(){a(".cancelEditActivity").unbind("click");a(".cancelEditActivity").click(function(){var b=
a(this).data();q(b.activityId)});a(".confirmEditActivity").unbind("click");a(".confirmEditActivity").click(function(){var b=a(this).data();G(b.activityId)})}}});