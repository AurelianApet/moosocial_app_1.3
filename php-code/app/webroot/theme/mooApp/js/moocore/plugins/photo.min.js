(function(a,e){"function"===typeof define&&define.amd?define("jquery mooBehavior mooAlert mooAjax mooPhrase mooOverlay mooPhotoTheater mooLike hideshare spinner".split(" "),e):"object"===typeof exports?module.exports=e(require("jquery")):a.mooPhoto=e()})(this,function(a,e,n,O,g,C,K,L){var p=!1,f=!1,h,k,q,r,t,u,v,w,c=0,l=0,x=0,m=0,D=2,F=function(){a(".showPhoto").unbind("click");a(".showPhoto").on("click",function(){var b=a(this).data();E(b.id)})},G=function(){a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+
"/photos/ajax_fetch",{type:type,album_type:album_type,album_type_id:album_type_id,target_id:target_id,page:D,taguserid:m},function(b){a("#photo_wrapper").spin(!1);""!=b&&(D++,a("#photo_thumbs ul").append(b),a("#photo_load_btn").parent().remove(),a("#photo_load_btn").unbind("click"),a("#photo_load_btn").on("click",function(){G()}),a(".showPhoto").unbind("click"),a(".showPhoto").on("click",function(){var b=a(this).data();E(b.id)}))})},M=function(){a("#set_cover").spin("tiny");a.post(mooConfig.url.base+
"/users/set_photo_as_cover",{photo_id:c},function(b){b=a.parseJSON(b);window.location=b.url})},A=function(){f=!0;a("#tag-wrapper img").css("cursor","crosshair");a("#tagPhoto a").html(g.__("done_tagging"));a("#tag-wrapper img").unbind("click");a("#tag-wrapper img").click(function(b){f&&(q=b.pageX-a("#tag-wrapper").offset().left,r=b.pageY-a("#tag-wrapper").offset().top,t=a("#tag-target").outerWidth(),u=a("#tag-target").outerHeight(),h=q-t/2,k=r-u/2,v=q+t/2,w=r-u/2,"block"==a("#tag-target").css("display")?
(a("#tag-target").animate({left:h,top:k},500),a("#tag-input").animate({left:v,top:w},500)):(a("#tag-target").css({left:h,top:k}).fadeIn(),a("#tag-input").css({left:v,top:w}).fadeIn()),a("#tag-name").focus(),a("#friends_list").html(a("#friends").html()),a(".tagFriends").unbind("click"),a(".tagFriends").on("click",function(){var b=a(this).data();y(b.id,b.tagValue)}))});a("#tag-cancel").unbind("click");a("#tag-cancel").click(function(){z();return!1});a("#tag-name").keyup(function(a){13==a.keyCode&&y(0,
"")});a("#tag-submit").unbind("click");a("#tag-submit").click(function(){y(0,"");return!1})},y=function(b,d){if(""!=b||""!=a("#tag-name").val()){var e="left:"+h+"px; top:"+k+"px";a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+"/photos/ajax_tag",{photo_id:c,uid:b,value:a("#tag-name").val(),style:e},function(c){a("#photo_wrapper").spin(!1);c=a.parseJSON(c);1==c.result?(d=b?'<a href="'+mooConfig.url.base+"/users/view/"+b+'">'+d+"</a>":a("#tag-name").val(),a("#tags").append('<span class="photoDetailTags" id="hotspot-item-'+
l+"-"+c.id+'" data-tag-id="'+c.id+'" id="hotspot-item-'+l+'">'+d+'<a class="photoDetailRemoveTags" data-id="'+c.id+'" href="javascript:void(0)"><i class="icon-delete cross-icon-sm"></i></a></span>'),a("#tag-wrapper").append('<div id="hotspot-'+l+"-"+c.id+'" class="hotspot" style="'+e+'"><span>'+d+"</span></div>"),z(),l++,a(".photoDetailTags").off("mouseout"),a(".photoDetailTags").off("mouseover"),a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();H("0-"+b.tagId)}).on("mouseover",
function(){var b=a(this).data();I("0-"+b.tagId)}),a(".photoDetailRemoveTags").unbind("click"),a(".photoDetailRemoveTags").on("click",function(){var b=a(this).data();J("0-"+b.id,b.id)})):n.alert(c.message)})}},N=function(){a("#set_avatar").spin("tiny");a.post(mooConfig.url.base+"/users/set_photo_as_profile_picture",{photo_id:c},function(b){b=a.parseJSON(b);window.location=b.url})},E=function(b){c=b;a("#photo_wrapper").spin("large");var d="";p=!1;d=x?b+"/uid:"+x:m?b+"?uid="+m:b;a("#preload").load(mooConfig.url.base+
"/photos/ajax_view/"+d,{noCache:1},function(){a("#photo_thumbs .active").removeClass("active");a("#photo_thumb_"+b).addClass("active");var d=a("#preload").html();""!=d&&(a("#preload").html(""),a("#photo-content").html(d),C.registerOverlay(),a(".sharethis").hideshare({media:a("#photo_src").attr("src"),linkedin:!1,link:window.location.href}),f&&A());a("#photo_wrapper").fadeIn()});window.history.pushState({photo_id:c},"",mooConfig.url.base+"/photos/view/"+d+"#content")},z=function(){a("#tag-target").fadeOut();
a("#tag-input").fadeOut();a("#tag-name").val("")},J=function(b,d){a("#hotspot-item-"+b).fadeOut();a("#hotspot-"+b).fadeOut();a.post(mooConfig.url.base+"/photos/ajax_remove_tag",{tag_id:d})},I=function(b){a("#hotspot-"+b).addClass("hotspothover")},H=function(b){a("#hotspot-"+b).removeClass("hotspothover")},B=function(){a(".deleteAlbum").unbind("click");a(".deleteAlbum").click(function(){var b=a(this).data(),b=mooConfig.url.base+"/albums/do_delete/"+b.id;n.confirm(g.__("are_you_sure_you_want_to_delete_this_album_all_photos_will_also_be_deleted"),
b)})};return{init:function(){K.init()},initOnCreateAlbum:function(){a("#saveBtn").unbind("click");a("#saveBtn").click(function(){a(this).addClass("disabled");e.createItem("albums",!0)});componentHandler.upgradeAllRegistered()},initOnListing:function(){e.initMoreResults();B()},initOnEditAlbum:function(){a("#select_photos").change(function(){"move"==a(this).val()?a("#album_id").show():a("#album_id").hide()});B()},initOnViewAlbum:function(){B()},initOnPhotoView:function(b){c=b.photo_id;photo_thumb=b.photo_thumb;
x=b.tag_uid;m=b.taguserid;type=b.type;target_id=b.target_id;album_type=b.album_type;album_type_id=b.album_type_id;a("#photo_thumbs ul li").unbind("click");a("#photo_thumbs ul li:not(.viewmore-photo)").click(function(){a("#photo_thumbs ul li").removeClass("active");a(this).addClass("active")});a("#photo_thumb_"+c).addClass("active");a(".sharethis").hideshare({media:mooConfig.url.base+"uploads/photos/thumbnail/"+c+"/"+photo_thumb,linkedin:!1});a("#photo_src").on("load",function(){if(!p){p=!0;var b=
a("#preload").html();""!=b&&(a("#preload").html(""),a("#photo-content").html(b),C.registerOverlay(),a(".sharethis").hideshare({media:a("#photo_src").attr("src"),linkedin:!1,link:window.location.href}),f&&A());a("#photo_wrapper").fadeIn()}});a("#delete_photo").unbind("click");a("#delete_photo").on("click",function(){var b=a(this).data().nextPhoto,b="undefined"!==typeof b?b:"0";n.confirm(g.__("are_you_sure_you_want_to_delete_this_photo"),mooConfig.url.base+"/photos/ajax_remove/photo_id:"+c+"/next_photo:"+
b)});a(".set_cover").unbind("click");a(".set_cover").on("click",function(){M()});a(".set_avatar").unbind("click");a(".set_avatar").on("click",function(){N()});a("#tagPhoto").unbind("click");a("#tagPhoto").click(function(){f?(f=!1,a("#tag-wrapper img").css("cursor","default"),a("#tagPhoto a").html(g.__("tag_photo")),a("#tag-name").unbind(),a("#tag-submit").unbind(),z()):A()});a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();H("0-"+b.tagId)}).on("mouseover",function(){var b=a(this).data();
I("0-"+b.tagId)});a(".photoDetailRemoveTags").unbind("click");a(".photoDetailRemoveTags").on("click",function(){var b=a(this).data();J("0-"+b.id,b.id)});L.initLikePhoto();F();a("#photo_load_btn").unbind("click");a("#photo_load_btn").on("click",function(){G()})},initShowPhoto:F}});