(function(a,d){"function"===typeof define&&define.amd?define("jquery mooPhrase mooMention mooEmoji mooBehavior mooAlert elastislide".split(" "),d):"object"===typeof exports?module.exports=d(require("jquery")):a.mooPhotoTheater=d()})(this,function(a,d,U,V,W,E){function r(){var b=a("#photo_src");a(window).height();var e,c;a("<img/>").attr("src",a(b).attr("src")).load(function(){e=this.width;c=this.height;c>=e?a(b).addClass("verticalImagePopup"):c<f-72?a(b).addClass("horizionImagePopup"):a(b).addClass("verticalImagePopup");
0<a("#theaterPhotoComment").length&&(U.init("theaterPhotoComment"),V.init("theaterPhotoComment"));a("#photo_wrapper").spin(!1);a("#tag-wrapper").show();a("#photo_src").css("visibility","visible");var f,d;992<a(window).width()?(f=a(window).height(),d=a("#photo_wrapper").width(),a("#photoModal #tag-wrapper").height(f-72),a("#photoModal #tag-wrapper .photo_img").height(f-72),a("#photoModal #tag-wrapper").width(d),a("#photoModal .photo_comments").height(f)):(f=a(window).height(),d=a(window).width(),a("#photoModal #tag-wrapper").height(f-
36),a("#photoModal #tag-wrapper .photo_img").height(f-36),a("#photoModal #tag-wrapper").width(d))})}function F(){var b=a("#preload").html();""!=b&&(a("#preload").html(""),element=a("<div>"+b+"</div>"),data=element.find("#photo_wrapper").data(),c=data.photoid,h=data.taguid,g=data.taguserid,k=data.nextphoto,t=data.thumbfull,a("#photo-content .photo_comments").hide(),element.find(".photo_comments").html()&&(a("#photo-content .photo_comments").html(element.find(".photo_comments").html()),a("#photo-content .photo_comments").show()),
a("#photo_wrapper .info").html(element.find(".info").html()),a("#photo-content #tag-wrapper").html(element.find("#tag-wrapper").html()),a("#photo-content #lb_description").html(""),a("#photo-content #lb_description").html(element.find("#lb_description").html()),a("#photo_wrapper").spin("large"),G(),r())}function H(b,e){"1"==e&&a("#thumb_list_popup").is(":visible")&&m.setCurrent(a("#photo_thumb_"+b).index());a("#theaterPhotoComment").destroyOverlayInstance(a("#theaterPhotoComment"));c=b;a("#thumb_list_popup .active").removeClass("active");
a("#photo_thumb_"+c).addClass("active");a("#photo_wrapper").spin("large");var d="",d=h?b+"/uid:"+h:b,f=d+"/time/"+(new Date).getTime();g&&(f+="?uid="+g,d+="?uid="+g);a("#preload").load(mooConfig.url.base+"/photos/ajax_view_theater/"+f,{noCache:0},function(){a("#photoModal .slimScrollDiv").attr("style","");a("#theaterComments").attr("style","");F()});window.history.pushState({photo_id:c},"",mooConfig.url.base+"/photos/view/"+d)}var c,I=!1,m,J=!1,K,u=!0,t,v,L=!1,l=!1,X=0,k="",M,w=!1,n,p,x,y,z,A,B,C,
h=0,g=0,Y=function(){a(".photoDetailTags").on("mouseout",function(){var b=a(this).data();N("0-"+b.tagId)}).on("mouseover",function(){var b=a(this).data();O("0-"+b.tagId)})},Z=function(){a(".photoDetailRemoveTags").unbind("click");a(".photoDetailRemoveTags").on("click",function(){var b=a(this).data();P("0-"+b.id,b.id)})},Q=function(){a(".showPhotoTheater").unbind("click");a(".showPhotoTheater").on("click",function(){var b=a(this).data();H(b.id,b.thumb)});Y();Z()},S=function(b){a.post(mooConfig.url.base+
"/photos/ajax_thumb_theater/"+c+"/"+b,function(e){a("#photo_thumbs ul").append(e);b==K?R():S(b+1)})},aa=function(){a(document).on("click","a.photoModal",function(b){I&&(b.preventDefault(),a("body").append('<div class="photo_modal_loading"></div>'),a(".photo_modal_loading").spin("large"),a.ajax({url:a(this).attr("href"),success:function(b){a("#photoModal .modal-content").html(b);a("#photoModal").modal("show")}}))})},ba=function(){a("#photoModal").on("shown.bs.modal",function(b){a(".photo_modal_loading").remove();
r();T();u&&R()});a("#photoModal").on("hidden.bs.modal",function(b){history.pushState({},"",v);a("#photoModal .modal-content").html("");a("#photoModal").removeData("bs.modal")})},T=function(){c=a("#photo_wrapper").data("photoid");h=a("#photo_wrapper").data("taguid");g=a("#photo_wrapper").data("taguserid");k=a("#photo_wrapper").data("nextphoto");t=a("#photo_wrapper").data("thumbfull");var b,e,d=a("#photo_wrapper").data("photocount"),f=a("#photo_wrapper").data("page");d>20*f?(K=Math.ceil(d/20),a("#photo_thumbs").spin(),
a("#thumb_list_popup").hide(),u=!1,S(2)):u=!0;J||(a(window).resize(function(){0!=a("#photo-content").length&&(992<a(window).width()?(b=a(window).height(),e=a("#photo_wrapper").width(),a("#photoModal #tag-wrapper").height(b-72),a("#photoModal #tag-wrapper .photo_img").height(b-72),a("#photoModal #tag-wrapper").width(e),a("#photoModal .photo_comments").height(b)):(b=a(window).height(),e=a(window).width(),a("#photoModal #tag-wrapper").height(b-36),a("#photoModal #tag-wrapper .photo_img").height(b-36),
a("#photoModal #tag-wrapper").width(e)),r(),a("#photo_src").css("visibility","visible"))}),a(document).keydown(function(b){a("#theaterPhotoComment").is(":focus")||a('[id^="message_item_comment_edit"]').is(":focus")||(37==b.keyCode?a("#photo_left_arrow_lg").trigger("click"):39==b.keyCode&&a("#photo_right_arro_lgw").trigger("click"))}),J=!0);a("#photo_thumbs ul li").unbind("click");a("#photo_thumbs ul li").click(function(){a("#photo_thumbs ul li").removeClass("active");a(this).addClass("active")});
a("#photo_wrapper").spin("large");a("#tag-wrapper").hide();url=h?c+"/uid:"+h:g?c+"?uid="+g:c;v=window.location.href;window.history.pushState({photo_id:c},"",mooConfig.url.base+"/photos/view/"+url);window.history.replaceState({photo_id:c},"",mooConfig.url.base+"/photos/view/"+url);M=window.location;G()},G=function(){a("#photo_wrapper .toogleThumb").unbind("click");a("#photo_wrapper .toogleThumb").click(function(){a("#photo_thumbs").toggle();a("#thumb_list_popup").is(":visible")&&m.setCurrent(a("#photo_thumb_"+
c).index())});a("#set_photo_cover").unbind("click");a("#set_photo_cover").click(function(){ca()});l=!1;a("#tagPhoto").unbind("click");a("#tagPhoto").click(function(){l?(l=!1,a("#tag-wrapper img").css("cursor","default"),a("#tagPhoto a").html(d.__("tag_photo")),a("#tag-name").unbind(),a("#tag-submit").unbind(),D()):da()});a("#set_profile_picture").unbind("click");a("#set_profile_picture").click(function(){ea()});a("#delete_photo").unbind("click");a("#delete_photo").click(function(){k=""!=k?k:"0";E.confirm(d.__("are_you_delete"),
mooConfig.url.base+"/photos/ajax_remove/photo_id:"+c+"/next_photo:"+k)});a("#photo_close_icon").unbind("click");a("#photo_close_icon").click(function(){history.pushState({},"",v)});a(".sharethis_theater").hideshare({media:t,linkedin:!1,link:M});W.registerImageComment();500<a("#theaterComments").height()&&a("#theaterComments").slimScroll({height:"500px",start:"top"}).bind("slimscroll",function(b,e){"bottom"==e&&""!=mooConfig.autoLoadMore&&0<a("#photoModal .view-more").length&&(a("#photoModal .view-more").before('<div style="text-align: center" class="loading"><img src="'+
mooConfig.url.base+'/img/loading.gif" /></div>'),a("#photoModal .view-more").find("a").trigger("click"))});a("#theaterPhotoComment").autogrow();componentHandler.upgradeAllRegistered()},D=function(){a("#tag-target").fadeOut();a("#tag-input").fadeOut();a("#tag-name").val("")},da=function(){l=!0;a("#tag-wrapper img").css("cursor","crosshair");a("#tagPhoto a").html(d.__("done_tagging"));a("#tag-wrapper img").unbind("click");a("#tag-wrapper img").click(function(b){l&&(x=b.pageX-a("#tag-wrapper").offset().left,
y=b.pageY-a("#tag-wrapper").offset().top,z=a("#tag-target").outerWidth(),A=a("#tag-target").outerHeight(),n=x-z/2,p=y-A/2,B=x+z/2,C=y-A/2,"block"==a("#tag-target").css("display")?(a("#tag-target").animate({left:n,top:p},500),a("#tag-input").animate({left:B,top:C},500)):(a("#tag-target").css({left:n,top:p}).fadeIn(),a("#tag-input").css({left:B,top:C}).fadeIn()),a("#tag-name").focus(),a("#friends_list").html(a("#friends").html()),a(".tagFriends").unbind("click"),a(".tagFriends").on("click",function(){var b=
a(this).data();q(b.id,b.tagValue)}))});a("#tag-cancel").unbind("click");a("#tag-cancel").click(function(){D();return!1});a("#tag-name").keyup(function(a){13==a.keyCode&&q(0,"")});a("#tag-submit").unbind("click");a("#tag-submit").click(function(){q(0,"");return!1})},q=function(b,e){if(""!=b||""!=a("#tag-name").val()){var d="left:"+n+"px; top:"+p+"px";a("#photo_wrapper").spin("large");a.post(mooConfig.url.base+"/photos/ajax_tag",{photo_id:c,uid:b,value:a("#tag-name").val(),style:d},function(c){a("#photo_wrapper").spin(!1);
c=a.parseJSON(c);1==c.result?(e=b?'<a href="'+mooConfig.url.base+"/users/view/"+b+'">'+e+"</a>":a("#tag-name").val(),a("#tags").append('<span id="hotspot-item-0-'+c.id+'" data-tag-id="'+c.id+'" class="photoDetailTags">'+e+'<a href="javascript:void(0)" class="photoDetailRemoveTags" data-id="'+c.id+'"><i class="icon-delete cross-icon-sm"></i></a></span>'),a("#tag-wrapper .photo_img").append('<div id="hotspot-0-'+c.id+'" class="hotspot" style="'+d+'"><span>'+e+"</span></div>"),D(),X++,Q()):E.alert(c.message)})}},
P=function(b,c){a("#hotspot-item-"+b).fadeOut();a("#hotspot-"+b).fadeOut();a.post(mooConfig.url.base+"/photos/ajax_remove_tag",{tag_id:c})},O=function(b){a("#hotspot-"+b).addClass("hotspothover")},N=function(b){a("#hotspot-"+b).removeClass("hotspothover")},R=function(){w=!1;m=a("#thumb_list_popup").elastislide({minItems:2,onReady:function(){m.setCurrent(a("#photo_thumb_"+c).index());a("#photo_thumbs").spin(!1);a("#photo_thumbs").css("visibility","visible");992>a(window).width()&&!w&&(w=!0,a("#photo_thumbs").toggle())}});
a("#photo_thumb_"+c).addClass("active")},ca=function(){a("#set_cover").spin("custom");a.post(mooConfig.url.base+"/users/set_photo_as_cover",{photo_id:c},function(b){b=a.parseJSON(b);location.assign(b.url)})},ea=function(){a("#set_avatar").spin("custom");a.post(mooConfig.url.base+"/users/set_photo_as_profile_picture",{photo_id:c},function(b){b=a.parseJSON(b);window.location=b.url})};return{init:function(){L||ba();L=!0;aa()},initShowPhoto:Q,start:function(){T()},submitTag:function(a,c){q(a,c)},removeTag:function(a,
c){P(a,c)},hideTag:function(a){N(a)},showTag:function(a){O(a)},showPhotoWrapper:function(){F()},showPhoto:function(a,c){"undefined"==typeof c&&(c=!1);H(a,c)},setActive:function(a){I=a}}});