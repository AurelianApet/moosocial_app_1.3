var sModal,file_uploading=0,keyEffect={},replaceLength={};
function validateUser(){return"undefined"==typeof mooViewer?($.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),model:"modal",title:mooPhrase.__("warning"),contents:mooPhrase.__("please_login")}).showModal(),!1):mooCore["setting.require_email_validation"]&&!mooViewer.is_confirmed?($.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),model:"modal",title:mooPhrase.__("warning"),contents:mooPhrase.__("please_confirm_your_email")}).showModal(),!1):mooCore["setting.approve_users"]&&!mooViewer.is_approved?($.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),
model:"modal",title:mooPhrase.__("warning"),contents:mooPhrase.__("your_account_is_pending_approval")}).showModal(),!1):!0}
function registerOverlay(){$(".overlay").unbind("click");$(".overlay").click(function(){overlay_title=$(this).attr("title");overlay_url=$(this).attr("href");sModal=(overlay_div=$(this).attr("rel"))?$.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),model:"modal",title:overlay_title,contents:$("#"+overlay_div).html()}):$.fn.SimpleModal({width:600,model:"modal-ajax",title:overlay_title,offsetTop:100,param:{url:overlay_url,onRequestComplete:function(){$(".tip").tipsy({html:!0,gravity:"s"})},onRequestFailure:function(){}}});
sModal.showModal();return!1})}function registerImageOverlay(){$(".attached-image").magnificPopup({type:"image",gallery:{enabled:!0},zoom:{enabled:!0,opener:function(a){return a}}})}
function submitComment(a){if(""!=jQuery.trim(jQuery("#commentForm_"+a).val())||""!=$("#comment_image_"+a).val())$("#commentButton_"+a+" a").addClass("disabled"),$("#commentButton_"+a+" a").prepend('<i class="icon-refresh icon-spin"></i>'),$.post(mooConfig.url.base+"/activities/ajax_comment",{activity_id:a,thumbnail:$("#comment_image_"+a).val(),comment:jQuery("#commentForm_"+a).val()},function(b){""!=b&&showPostedComment(a,b)})}
function submitItemComment(a,b,c){if(""!=$.trim(jQuery("#commentForm_"+c).val())||""!=$("#comment_image_"+c).val())$("#commentButton_"+c+" a").prepend('<i class="icon-refresh icon-spin"></i>'),$("#commentButton_"+c+" a").addClass("disabled"),$.post(mooConfig.url.base+"/comments/ajax_share",{type:a,target_id:b,thumbnail:$("#comment_image_"+c).val(),message:jQuery("#commentForm_"+c).val(),activity:1},function(a){""!=a&&showPostedComment(c,a)})}
function showPostedComment(a,b){$("#newComment_"+a).before(b);$(".slide").slideDown();$("#commentButton_"+a+" a").removeClass("disabled");$("#commentButton_"+a+" a i").remove();$("#commentForm_"+a).val("");$("#commentButton_"+a).hide();registerCrossIcons();$(".commentBox").css("height","27px");$("#comment_preview_image_"+a).html("");$("#comment_image_"+a).val("");$("#comment_button_attach_"+a).show();registerImageComment()}
function showCommentForm(a){jQuery("#comments_"+a).show();jQuery("#newComment_"+a).show();$("#commentForm_"+a).focus()}function resetVideoUpload(){$("#video_pc_feed_preview").hide();$("#title").val("");$("#description").val("");$("#video_destination").val("")}
function postWall(){if(!validateUser())return!1;var a=$("#message").val();""!=$.trim(a)||""!=$("#wall_photo_preview :not(#addMoreImage)").html()?(disableButton("status_btn"),$("#status_btn").spin("small"),$.post(mooConfig.url.base+"/activities/ajax_share",$("#wallForm").serialize(),function(a){$("#wall_photo").val("");enableButton("status_btn");$("#message").val("");0<$("#video_destination").length&&""!=$("#video_destination").val()?($.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),model:"modal",title:mooPhrase.__("processing_video"),
contents:mooPhrase.__("processing_video_msg")}).showModal(),setTimeout(function(){$("#simpleModal").hide();$(".modal-backdrop").remove()},3E3),resetVideoUpload(),$parseJSON=$.parseJSON(a),$.post(mooConfig.url.base+"/upload_video/upload_videos/feed_convert",{activity_id:$parseJSON.activity_id},function(a){})):""!=a&&(0<$(".no-feed").length&&$("#list-content .no-feed").remove(),$("#list-content").prepend(a),registerCrossIcons(),$("#message").css("height","36px"),$(".slide").slideDown(),$("#wall_photo_preview span:not(.addMoreImage)").remove(),
$("#addMoreImage").hide(),$(".form-feed-holder").css("padding-bottom","0px"),a=$(a).find("div[id^=comment_button_attach_]").data("id"),registerAttachComment(a));$("#status_btn").spin(!1);MooResponsive.init();$(".tip").tipsy({html:!0,gravity:"s"});$('[data-toggle="tooltip"]').tooltip()}),$(".stt-action .userTagging-userTagging").addClass("hidden"),$(".stt-action").css("margin-top","0"),$("#wall_photo_preview").hide(),$("#userTagging").tagsinput("removeAll"),componentHandler.upgradeAllRegistered()):
$.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),model:"modal",title:mooPhrase.__("warning"),contents:mooPhrase.__("share_whats_new_can_not_empty")}).showModal()}
function ajax_postComment(a){if(""!=$.trim($("#postComment").val())||""!=$.trim($("#theaterPhotoComment").val())||""!=$("#comment_image_"+a).val()){$("#shareButton").addClass("disabled");$("#shareButton").prepend('<i class="icon-refresh icon-spin"></i>');var b="";$("#commentForm").length&&(b=$("#commentForm").serialize());$("#theaterPhotoCommentForm").length&&(b=$("#theaterPhotoCommentForm").serialize());$.post(mooConfig.url.base+"/comments/ajax_share",b,function(b){$("#shareButton").removeClass("disabled");
$("#shareButton i").remove();$(".commentForm").css("height","35px");$("#postComment").length&&$("#postComment").val("");$("#theaterPhotoComment").length&&$("#theaterPhotoComment").val("");""!=b&&($("#theaterComments").length?$("#theaterComments").prepend(b):$("#comments").prepend(b),$(".slide").slideDown(),$("#theaterComments").length||$("#comment_count").html(parseInt($("#comment_count").html())+1),$("#comment_preview_image_"+a).html(""),$("#comment_image_"+a).val(""),$("#comment_button_attach_"+
a).show(),registerImageComment(),componentHandler.upgradeAllRegistered())})}else $.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),model:"modal",title:mooPhrase.__("warning"),contents:mooPhrase.__("comment_empty")}).showModal()}var activity_edit_array=[];
function editActivity(a){-1===activity_edit_array.indexOf(a)&&$.post(mooConfig.url.base+"/activities/ajax_loadActivityEdit/"+a,function(b){$("#activity_feed_content_text_"+a+" .comment_message").hide();$(b).insertAfter($("#activity_feed_content_text_"+a+" .comment_message"));activity_edit_array.push(a)})}function cancelEditActivity(a){$("#activity_feed_content_text_"+a+" .comment_message").show();$("#activity_edit_"+a).remove();a=$.inArray(a,activity_edit_array);activity_edit_array.splice(a,1)}
function confirmEditActivity(a){""!=$.trim($("#message_edit_"+a).val())&&$.post(mooConfig.url.base+"/activities/ajax_editActivity/"+a,{message:jQuery("#message_edit_"+a).val()},function(b){$("#activity_feed_content_text_"+a+" .comment_message").html($(b).html());$("#history_activity_"+a).show();cancelEditActivity(a)})}
function cancelEditActivityComment(a){$("#message_activity_comment_edit_"+a).siblings(".textoverlay")&&$("#message_activity_comment_edit_"+a).destroyOverlayInstance($("#message_activity_comment_edit_"+a));$("#activity_feed_comment_text_"+a).show();$("#activity_comment_edit_"+a).remove();a=$.inArray(a,activity_comment_edit_array);activity_comment_edit_array.splice(a,1)}
function confirmEditActivityComment(a){if(""!=$.trim($("#message_activity_comment_edit_"+a).val())||""!=$("#activity_comment_attach_id_"+a).val()){var b;b=0!=jQuery("#message_activity_comment_edit_"+a+"_hidden").length?jQuery("#message_activity_comment_edit_"+a+"_hidden").val():jQuery("#message_activity_comment_edit_"+a).val();$.post(mooConfig.url.base+"/activities/ajax_editActivityComment/"+a,{comment_attach:$("#activity_comment_attach_id_"+a).val(),message:b},function(b){$("#message_activity_comment_edit_"+
a).siblings(".textoverlay")&&$("#message_activity_comment_edit_"+a).destroyOverlayInstance($("#message_activity_comment_edit_"+a));$("#activity_feed_comment_text_"+a).html($(b).html());$("#history_activity_comment_"+a).show();registerImageComment();cancelEditActivityComment(a)})}}
function cancelEditItemComment(a,b){$("#message_item_comment_edit_"+a).siblings(".textoverlay")&&$("#message_item_comment_edit_"+a).destroyOverlayInstance($("#message_item_comment_edit_"+a));var c="#item_feed_comment_text_";"undefined"!==typeof b&&b&&(c="#photo_feed_comment_text_");$(c+a).show();$("#item_comment_edit_"+a).remove();c=$.inArray(a,item_comment_edit_array);item_comment_edit_array.splice(c,1)}
function removeItemComment(a,b){$.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),btn_cancel:mooPhrase.__("btn_cancel"),callback:function(){$.post(mooConfig.url.base+"/comments/ajax_remove",{id:a},function(){$("#itemcomment_"+a).fadeOut("normal",function(){$("#itemcomment_"+a).remove();b?$("#photo_comment_"+a).remove():$("#comment_count").html(parseInt($("#comment_count").html())-1)})})},title:mooPhrase.__("please_confirm"),contents:mooPhrase.__("confirm_delete_comment"),model:"confirm",hideFooter:!1,
closeButton:!1}).showModal()}
function confirmEditItemComment(a,b){if(""!=$.trim($("#message_item_comment_edit_"+a).val())||""!=$("#item_comment_attach_id_"+a).val()){var c;c=0!=jQuery("#message_item_comment_edit_"+a+"_hidden").length?jQuery("#message_item_comment_edit_"+a+"_hidden").val():jQuery("#message_item_comment_edit_"+a).val();$.post(mooConfig.url.base+"/comments/ajax_editComment/"+a,{comment_attach:$("#item_comment_attach_id_"+a).val(),message:c},function(c){$("#message_item_comment_edit_"+a).siblings(".textoverlay")&&
$("#message_item_comment_edit_"+a).destroyOverlayInstance($("#message_item_comment_edit_"+a));$("#item_feed_comment_text_"+a).html($(c).html());$("#photo_feed_comment_text_"+a).html($(c).html());$("#history_item_comment_"+a).show();$("#history_activity_comment_"+a).show();registerImageComment();cancelEditItemComment(a,b)})}}function removePhotoComment(a,b){$("#"+a+"_comment_attach_id_"+b).val("");$("#"+a+"_comment_preview_attach_"+b).html("");$("#"+a+"_comment_attach_"+b).show()}
function createItem(a,b){disableButton("saveBtn");var c="ajax_save";b&&(c="save");mooAjax.post({url:mooConfig.url.base+"/"+a+"/"+c,data:jQuery("#createForm").serialize()},function(b){b=$.parseJSON(b);1==b.result?window.location=mooConfig.url.base+"/"+a+"/view/"+b.id:(enableButton("saveBtn"),$(".error-message").show(),$(".error-message").html(b.message),0<$(".spinner").length&&$(".spinner").remove())})}
function moreResults(a,b,c){$(c).spin("small");$(c).parent().css("display","none");"undefined"===typeof window.searchParams&&(window.searchParams="");$.post(mooConfig.url.base+a,window.searchParams,function(a){$(c).spin(!1);$("#"+b).find(".view-more:first").remove();$("#"+b).children(".clear:first").remove();$("#"+b).find(".loading:first").remove();flagScroll=!0;"comments"==b||"theaterComments"==b?($("#"+b).append(a),$("#"+b+" .view-more").insertAfter("#"+b+' li[id^="itemcomment_"]:last')):$("#"+
b).append(a);registerOverlay();registerImageComment();$(".tip").tipsy({html:!0,gravity:"s"});window.initShareBtn();MooResponsive.initFeedImage();componentHandler.upgradeAllRegistered()})}function mooAlert(a){$.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),title:mooPhrase.__("message"),hideFooter:!1,closeButton:!1,model:"alert",contents:a}).showModal()}
function mooConfirm(a,b){$($("#portlet-config  .modal-header .modal-title")[0]).html(mooPhrase.__("please_confirm"));$($("#portlet-config  .modal-body")[0]).html(a);$("#portlet-config  .modal-footer .ok").click(function(){window.location=b});$("#portlet-config").modal("show")}function mooAjax(a,b,c,d){"get"==b.toLowerCase()?$.ajax({url:a,data:c,success:d}):"post"==b.toLowerCase()&&$.ajax({type:"POST",url:a,data:c,success:d})}
function toggleCheckboxes(a){a.checked?jQuery(".check").attr("checked","checked"):jQuery(".check").attr("checked",!1)}function confirmSubmitForm(a,b){$.fn.SimpleModal({btn_ok:"OK",model:"confirm",callback:function(){document.getElementById(b).submit()},title:"Please Confirm",contents:a,hideFooter:!1,closeButton:!1}).showModal()}function registerCrossIcons(){}
function likeIt(a,b,c){jQuery.post(mooConfig.url.base+"/likes/ajax_add/"+a+"/"+b+"/"+c,{noCache:1},function(a){try{var b=jQuery.parseJSON(a);jQuery("#like_count").html(parseInt(b.like_count));jQuery("#dislike_count").html(parseInt(b.dislike_count));jQuery("#like_count2").html(parseInt(b.like_count));jQuery("#dislike_count2").html(parseInt(b.dislike_count));c?(jQuery("#like_count").parent().prev().toggleClass("active"),jQuery("#dislike_count").parent().prev().removeClass("active")):(jQuery("#dislike_count").parent().prev().toggleClass("active"),
jQuery("#like_count").parent().prev().removeClass("active"))}catch(f){validateUser()}})}
function likePhoto(a,b){jQuery.post(mooConfig.url.base+"/likes/ajax_add/Photo_Photo/"+a+"/"+b,{noCache:1},function(a){try{var d=jQuery.parseJSON(a);jQuery("#photo_like_count2").html(parseInt(d.like_count));jQuery("#photo_dislike_count2").html(parseInt(d.dislike_count));b?(jQuery("#photo_like_count").toggleClass("active"),jQuery("#photo_dislike_count").removeClass("active")):(jQuery("#photo_dislike_count").toggleClass("active"),jQuery("#photo_like_count").removeClass("active"))}catch(e){validateUser()}})}
function likeActivity(a,b,c){$.post(mooConfig.url.base+"/likes/ajax_add/"+("photo_comment"==a?"comment":a)+"/"+b+"/"+c,{noCache:1},function(d){try{var e=$.parseJSON(d);$("#"+a+"_like_"+b).html(parseInt(e.like_count));$("#"+a+"_dislike_"+b).html(parseInt(e.dislike_count));"comment"==a&&($("#photo_comment_like_"+b).html(parseInt(e.like_count)),$("#photo_comment_dislike_"+b).html(parseInt(e.dislike_count)));c?($("#"+a+"_l_"+b).toggleClass("active"),$("#"+a+"_d_"+b).removeClass("active"),"comment"==a&&
($("#photo_comment_l_"+b).toggleClass("active"),$("#photo_comment_d_"+b).removeClass("active"))):($("#"+a+"_d_"+b).toggleClass("active"),$("#"+a+"_l_"+b).removeClass("active"),"comment"==a&&($("#photo_comment_d_"+b).toggleClass("active"),$("#photo_comment_l_"+b).removeClass("active")))}catch(f){validateUser()}})}
function showFeedVideo(a,b,c){$("#video_teaser_"+c+" .vid_thumb").spin("small");$("#video_teaser_"+c).load(mooConfig.url.base+"/videos/embed",{source:a,source_id:b},function(){$("#video_teaser_"+c+" > .vid_thumb").spin(!1)})}
function toggleMenu(a){"leftnav"==a?"-200px"==jQuery("#leftnav").css("left")?(jQuery("#leftnav").animate({left:0},300),jQuery("#right").animate({right:-204},300),jQuery("#center").animate({left:200},300)):(jQuery("#leftnav").animate({left:-200},300),jQuery("#center").animate({left:0},300)):"-204px"==jQuery("#right").css("right")?(jQuery("#right").show(),jQuery("#right").animate({right:0},300),jQuery("#leftnav").animate({left:-200},300),jQuery("#center").animate({left:0},300)):jQuery("#right").animate({right:-204},
300,function(){jQuery("#right").hide()})}function showMooDropdown(a){jQuery(a).next().toggle()}function doModeration(a,b){switch(a){case "delete":$("#deleteForm").attr("action",mooConfig.url.base+"/admin/"+b+"/delete");confirmSubmitForm("Are you sure you want to delete these "+b+"?","deleteForm");break;case "move":$("#deleteForm").attr("action",mooConfig.url.base+"/admin/"+b+"/move");$("#category_id").show();break;default:$("#category_id").hide()}}var tmp_class;
function disableButton(a){tmp_class=$("#"+a+" i").attr("class");$("#"+a+" i").attr("class","icon-refresh icon-spin");$("#"+a).addClass("disabled")}function enableButton(a){$("#"+a+" i").attr("class",tmp_class);$("#"+a).removeClass("disabled")}function initTabs(a){jQuery("#"+a+" .tabs > li").click(function(){jQuery("#"+a+" li").removeClass("active");jQuery(this).addClass("active");jQuery("#"+a+" .tab").hide();jQuery("#"+jQuery(this).attr("id")+"_content").show()})}
function showMore(a){$(a).prev().css("max-height","none");$(a).replaceWith('<a href="javascript:void(0)" onclick="showLess(this)" class="show-more">'+$(a).prev().data("less-text")+"</a>")}function showLess(a){$(a).prev().css("max-height","");$(a).replaceWith('<a href="javascript:void(0)" onclick="showMore(this)" class="show-more">'+$(a).prev().data("more-text")+"</a>")}
function removeNotification(a){mooAjax(mooConfig.url.base+"/notifications/ajax_remove/"+a,"get","",function(b){$("#noti_"+a).slideUp();$("#noti_"+a).hasClass("unread")&&"0"!=jQuery("#notification_count").html()&&(b=parseInt($(".notification_count").html())-1,0==b?$(".notification_count").remove():$(".notification_count").html(b),$("#notification_count").html(b),Tinycon.setBubble(b))})}
function registerAttachComment(a){new qq.FineUploader({element:$("#comment_button_attach_"+a)[0],text:{uploadButton:'<div class="upload-section"><i class="material-icons">local_see</i></div>'},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},multiple:!1,request:{endpoint:mooConfig.url.base+"/upload/wall"},callbacks:{onError:mooGlobal.errorHandler,onSubmit:function(b,c){var d=$('<span id="attach_'+a+"_"+b+'" style="background-image:url('+mooConfig.url.base+'/img/indicator.gif);background-size:inherit;background-repeat:no-repeat"></span>');
$("#comment_preview_image_"+a).append(d);$("#comment_button_attach_"+a).hide()},onComplete:function(b,c,d,e){$(this.getItemByFileId(b)).remove();img=$('<img src="'+mooConfig.url.base+"/"+d.photo+'">');img.load(function(){var c=$("#attach_"+a+"_"+b);c.attr("style","background-image:url("+mooConfig.url.base+"/"+d.photo+")");var e=$('<a href="javascript:void(0);"><i class="icon-delete"></i></a>');c.append(e);c.find(".icon-delete").click(function(){c.remove();$("#comment_button_attach_"+a).show();$("#comment_image_"+
a).val("")})});$("#comment_image_"+a).val(d.photo)}}})}
function registerAttachCommentEdit(a,b){new qq.FineUploader({element:$("#"+a+"_comment_attach_"+b)[0],text:{uploadButton:'<div class="upload-section"><i class="material-icons">local_see</i></div>'},validation:{allowedExtensions:mooConfig.photoExt,sizeLimit:mooConfig.sizeLimit},multiple:!1,request:{endpoint:mooConfig.url.base+"/upload/wall"},callbacks:{onError:mooGlobal.errorHandler,onSubmit:function(c,d){var e=$('<span id="attach__'+b+"_"+c+'" style="background-image:url('+mooConfig.url.base+'/img/indicator.gif);background-size:inherit;background-repeat:no-repeat"></span>');
$("#"+a+"_comment_preview_attach_"+b).append(e);$("#"+a+"_comment_attach_"+b).hide()},onComplete:function(c,d,e,f){$(this.getItemByFileId(c)).remove();img=$('<img src="'+mooConfig.url.base+"/"+e.photo+'">');img.load(function(){var d=$("#attach__"+b+"_"+c);d.attr("style","background-image:url("+mooConfig.url.base+"/"+e.photo+")");var f=$('<a href="javascript:void(0);"><i class="icon-delete"></i></a>');d.append(f);d.find(".icon-delete").click(function(){d.remove();$("#"+a+"_comment_attach_"+b).show();
$("#"+a+"_comment_attach_id_"+b).val("")})});$("#"+a+"_comment_attach_id_"+b).val(e.photo);$("#"+a+"_comment_attach_"+b).hide()}}})}function registerImageComment(){$(".comment_thumb a").length&&$(".comment_thumb a").magnificPopup({type:"image",gallery:{enabled:!1},image:{cursor:""}})}
var flagScroll=!0,isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};
function toggleUploadPhoto(){var a=parseInt($(".stt-action").css("marginTop"));30>=a&&(a+=75,$(".stt-action").css("margin-top",a));a=$(".stt-action > #userTagging-id-userTagging > .userTagging-userTagging").hasClass("hidden")?39:70;$("#wall_photo_preview").css("bottom",a)}window.closeModal=function(){$("#shareFeedModal").modal("hide")};window.statusModal=function(a,b){$.fn.SimpleModal({btn_ok:mooPhrase.__("btn_ok"),model:"modal",title:a,contents:b}).showModal()};
window.initShareBtn=function(){$("body").off("click",".shareFeedBtn").on("click",".shareFeedBtn",function(){var a=$(this).attr("share-url");$.post(mooConfig.url.base+"/share/index",function(b){try{b=JSON.parse(b),b.nonLogin&&validateUser()}catch(c){$("#shareFeedModal iframe").attr("src",a),$("#shareFeedModal").modal({show:!0})}})})};$(document).ready(function(){$(window).on("beforeunload",function(){if(1==file_uploading)return confirmNavigation()});window.initShareBtn()});
$(document).keyup(function(a){if(27==a.keyCode&&1==file_uploading)return confirmNavigation()});function confirmNavigation(){if(1==file_uploading){var a=mooPhrase.__("are_you_sure_leave_this_page");if(confirm(a))return file_uploading=0,$(window).unbind("beforeunload"),$("#themeModal").modal("hide"),!0}else file_uploading=0,$("#themeModal").modal("hide")}
$(document).ready(function(){$(".accept-cookie").on("click",function(){var a=$(this).data("answer");$(this);$.post(mooConfig.url.base+"/users/accept_cookie",{answer:a},function(a){a=JSON.parse(a);a.result?$("#cookies-warning").remove():location.href=a.url})});$(".delete-warning-cookies").on("click",function(){$("#cookies-warning").remove();$("body").removeClass("page_has_cookies")})});$(window).load(function(){$("#status_box").slideDown("slow")});